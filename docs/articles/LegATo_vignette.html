<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="LegATo">
<title>LegATo Tutorial • LegATo</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="LegATo Tutorial">
<meta property="og:description" content="LegATo">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">LegATo</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.99.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../index.html">Home</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-tutorials">Tutorials</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-tutorials">
    <a class="dropdown-item" href="../articles/LegATo_vignette.html">Command Line Analysis</a>
    <a class="dropdown-item" href="../articles/NMIT.html">NMIT</a>
    <a class="dropdown-item" href="../articles/Modeling.html">Modeling with GEEs and LMMs</a>
    <a class="dropdown-item" href="../articles/Hotelling.html">Hotelling's T-Squared Test</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Function Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Package News</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/aubreyodom/legato">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>LegATo Tutorial</h1>
                        <h4 data-toc-skip class="author">Aubrey R.
Odom</h4>
            <address class="author_afil">
      Program in Bioinformatics, Boston University, Boston,
MA<br><a class="author_email" href="mailto:#"></a><a href="mailto:aodom@bu.edu" class="email">aodom@bu.edu</a>
      </address>
                  
            <h4 data-toc-skip class="date">January 30, 2024</h4>
      
      
      <div class="d-none name"><code>LegATo_vignette.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction-to-legato">Introduction to LegATo<a class="anchor" aria-label="anchor" href="#introduction-to-legato"></a>
</h2>
<div class="section level3">
<h3 id="streamlining-longitudinal-microbiome-profiling-in-bioconductor">Streamlining longitudinal microbiome profiling in Bioconductor<a class="anchor" aria-label="anchor" href="#streamlining-longitudinal-microbiome-profiling-in-bioconductor"></a>
</h3>
<p>Microbiome time-series data presents several distinct challenges,
including complex covariate dependencies and a variety of longitudinal
study designs. Furthermore, while several individual tools have been
created to aid in longitudinal microbiome data analysis, an
all-inclusive R-based toolkit has remained elusive.</p>
<p>To address these concerns, LegATo (Longitudinal mEtaGenomic Analysis
TOolkit) has risen from the ashes. LegATo is a suite of open-source
software tools for longitudinal microbiome analysis that is extendable
to several different study forms, all while promising optimal
ease-of-use for researchers. This toolkit will allow researchers to
determine which microbial taxa are affected over time by perturbations
such as onset of disease or lifestyle choices, and to predict the
effects of these perturbations over time, including changes in
composition or stability of commensal bacteria.</p>
<p>Currently, LegATo entertains a number of data cleaning, aggregation,
modeling and testing procedures. As we develop or learn of new methods,
we will add to the toolkit accordingly. We will soon add hierarchical
clustering tools and multivariate generalized estimating equations
(JGEEs) to adjust for the compositional nature of microbiome data.</p>
</div>
</div>
<div class="section level2">
<h2 id="getting-started-with-legato">Getting started with LegATo<a class="anchor" aria-label="anchor" href="#getting-started-with-legato"></a>
</h2>
<div class="section level3">
<h3 id="compatibility-with-multiassayexperiment-and-summarizedexperiment-objects">Compatibility with <code>MultiAssayExperiment</code> and
<code>SummarizedExperiment</code> objects<a class="anchor" aria-label="anchor" href="#compatibility-with-multiassayexperiment-and-summarizedexperiment-objects"></a>
</h3>
<p>The convenience of LegATo is in part credited to the integration of
<code>MultiAssayExperiment</code> and <code>SummarizedExperiment</code>
objects. These are reliable and clean data structures developed by the
as part of the <em><a href="https://bioconductor.org/packages/3.17/MultiAssayExperiment" class="external-link">MultiAssayExperiment</a></em>
and <em><a href="https://bioconductor.org/packages/3.17/SummarizedExperiment" class="external-link">SummarizedExperiment</a></em>
packages.</p>
<p>The <code>MultiAssayExperiment</code> container concisely stores a
<code>SummarizedExperiment</code> object, which aggregates data matrices
along with annotation information, metadata, and reduced dimensionality
data (PCA, t-SNE, etc.). To learn more about proper usage and context of
these objects, you may want to take a look at the <a href="https://bioconductor.org/packages/release/bioc/vignettes/MultiAssayExperiment/inst/doc/MultiAssayExperiment.html" class="external-link">MultiAssayExperiment
package vignette</a> and <a href="https://bioconductor.org/packages/release/bioc/vignettes/SummarizedExperiment/inst/doc/SummarizedExperiment.html" class="external-link">SummarizedExperiment
package vignette</a>.</p>
<p>To install these two packages, run the following code:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"BiocManager"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"BiocManager"</span><span class="op">)</span></span>
<span><span class="fu">BiocManager</span><span class="fu">::</span><span class="fu"><a href="https://bioconductor.github.io/BiocManager/reference/install.html" class="external-link">install</a></span><span class="op">(</span><span class="st">"SummarizedExperiment"</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"BiocManager"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"BiocManager"</span><span class="op">)</span></span>
<span><span class="fu">BiocManager</span><span class="fu">::</span><span class="fu"><a href="https://bioconductor.github.io/BiocManager/reference/install.html" class="external-link">install</a></span><span class="op">(</span><span class="st">"SummarizedExperiment"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="installation-and-setup">Installation and setup<a class="anchor" aria-label="anchor" href="#installation-and-setup"></a>
</h3>
<p>In order to install the development version of LegATo from Github,
run the following code:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"devtools"</span>, quietly<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"devtools"</span><span class="op">)</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"wejlab/LegATo"</span><span class="op">)</span></span></code></pre></div>
<p>Now we’ll load the LegATo package into our library:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">LegATo</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="formatting-input-data-for-use-with-legato">Formatting input data for use with LegATo<a class="anchor" aria-label="anchor" href="#formatting-input-data-for-use-with-legato"></a>
</h2>
<p>LegATo functions expect data that is properly formatted in a
<code>MultiAssayExperiment</code> container that is compatible with the
<a href="https://wejlab.github.io/animalcules-docs/" class="external-link">animalcules
package</a>. Obtaining properly formatted data can be achieved easily
via the <code><a href="../reference/create_formatted_MAE.html">create_formatted_MAE()</a></code> function from the LegATo
package, as detailed below.</p>
<div class="section level3">
<h3 id="a-note-on-compatibility-with-other-packages">A note on compatibility with other packages<a class="anchor" aria-label="anchor" href="#a-note-on-compatibility-with-other-packages"></a>
</h3>
<p>If you’ve analyzed your metagenomic or 16S data via the <a href="https://wejlab.github.io/metascope-docs/" class="external-link">MetaScope package</a>,
you can aggregate your sample outputs with user-input metadata using the
<code>convert_animalcules()</code> or
<code>convert_animalcules_silva()</code> functions. These functions
create a taxonomy table and collate all data into a LegATo- and
animalcules-compatible <code>MultiAssayExperiment</code> object.</p>
<p>You can also format your data analyzed elsewhere (like PathoScope
2.0) with the <a href="https://wejlab.github.io/animalcules-docs/" class="external-link">animalcules
package</a> in the upload step with the R Shiny app, and then select
“Download Animalcules File” to obtain a <code>MAE</code> object that can
be used with LegATo.</p>
</div>
<div class="section level3">
<h3 id="requirements-for-using-create_formatted_mae">Requirements for using <code>create_formatted_MAE()</code><a class="anchor" aria-label="anchor" href="#requirements-for-using-create_formatted_mae"></a>
</h3>
<p>For the purposes of this example, we’ll look at some example inputs
unrelated to the main HIV-E infant data:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">counts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"counts.csv"</span>, package <span class="op">=</span> <span class="st">"LegATo"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span>row.names <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename_with</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html" class="external-link">str_replace</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"\\."</span>, <span class="st">"-"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">tax</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"tax.csv"</span>, package <span class="op">=</span> <span class="st">"LegATo"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span>row.names <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">sample</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"sample.csv"</span>, package <span class="op">=</span> <span class="st">"LegATo"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span>row.names <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p>Now we’ll look at the formatting of each:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ndim</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span><span class="va">counts</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">ndim</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">ndim</span><span class="op">)</span><span class="op">]</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span>caption <span class="op">=</span> <span class="st">"Counts Table Preview"</span>,</span>
<span>               label <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>Counts Table Preview</caption>
<thead><tr class="header">
<th align="left"></th>
<th align="right">X-1</th>
<th align="right">X-2</th>
<th align="right">X-3</th>
<th align="right">X-4</th>
<th align="right">X-5</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Acinetobacter_beijerinckii</td>
<td align="right">430</td>
<td align="right">18103</td>
<td align="right">810</td>
<td align="right">103</td>
<td align="right">74</td>
</tr>
<tr class="even">
<td align="left">Acinetobacter_bouvetii</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">Acinetobacter_guillouiae</td>
<td align="right">0</td>
<td align="right">5</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">Acinetobacter_gyllenbergii</td>
<td align="right">6</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">11</td>
</tr>
<tr class="odd">
<td align="left">Acinetobacter_indicus</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">9</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tax</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">ndim</span><span class="op">)</span>, <span class="op">]</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span>caption <span class="op">=</span> <span class="st">"Taxonomy Table Preview"</span>,</span>
<span>               label <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>Taxonomy Table Preview</caption>
<colgroup>
<col width="18%">
<col width="9%">
<col width="10%">
<col width="13%">
<col width="9%">
<col width="9%">
<col width="9%">
<col width="18%">
</colgroup>
<thead><tr class="header">
<th align="left"></th>
<th align="left">superkingdom</th>
<th align="left">phylum</th>
<th align="left">class</th>
<th align="left">order</th>
<th align="left">family</th>
<th align="left">genus</th>
<th align="left">species</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Acinetobacter_beijerinckii</td>
<td align="left">Bacteria</td>
<td align="left">Proteobacteria</td>
<td align="left">Gammaproteobacteria</td>
<td align="left">Moraxellales</td>
<td align="left">Moraxellaceae</td>
<td align="left">Acinetobacter</td>
<td align="left">Acinetobacter_beijerinckii</td>
</tr>
<tr class="even">
<td align="left">Acinetobacter_bouvetii</td>
<td align="left">Bacteria</td>
<td align="left">Proteobacteria</td>
<td align="left">Gammaproteobacteria</td>
<td align="left">Moraxellales</td>
<td align="left">Moraxellaceae</td>
<td align="left">Acinetobacter</td>
<td align="left">Acinetobacter_bouvetii</td>
</tr>
<tr class="odd">
<td align="left">Acinetobacter_guillouiae</td>
<td align="left">Bacteria</td>
<td align="left">Proteobacteria</td>
<td align="left">Gammaproteobacteria</td>
<td align="left">Moraxellales</td>
<td align="left">Moraxellaceae</td>
<td align="left">Acinetobacter</td>
<td align="left">Acinetobacter_guillouiae</td>
</tr>
<tr class="even">
<td align="left">Acinetobacter_gyllenbergii</td>
<td align="left">Bacteria</td>
<td align="left">Proteobacteria</td>
<td align="left">Gammaproteobacteria</td>
<td align="left">Moraxellales</td>
<td align="left">Moraxellaceae</td>
<td align="left">Acinetobacter</td>
<td align="left">Acinetobacter_gyllenbergii</td>
</tr>
<tr class="odd">
<td align="left">Acinetobacter_indicus</td>
<td align="left">Bacteria</td>
<td align="left">Proteobacteria</td>
<td align="left">Gammaproteobacteria</td>
<td align="left">Moraxellales</td>
<td align="left">Moraxellaceae</td>
<td align="left">Acinetobacter</td>
<td align="left">Acinetobacter_indicus</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sample</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">ndim</span><span class="op">)</span>, <span class="op">]</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span>caption <span class="op">=</span> <span class="st">"Sample Table Preview"</span>,</span>
<span>               label <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>Sample Table Preview</caption>
<thead><tr class="header">
<th align="left"></th>
<th align="left">Sample</th>
<th align="left">Subject</th>
<th align="left">Sex</th>
<th align="right">Month</th>
<th align="left">Group</th>
<th align="right">Pairing</th>
<th align="right">HairLength</th>
<th align="right">Age</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">X-1</td>
<td align="left">X-1</td>
<td align="left">S1</td>
<td align="left">Male</td>
<td align="right">1</td>
<td align="left">A</td>
<td align="right">1</td>
<td align="right">48.62753</td>
<td align="right">21.9</td>
</tr>
<tr class="even">
<td align="left">X-2</td>
<td align="left">X-2</td>
<td align="left">S2</td>
<td align="left">Male</td>
<td align="right">1</td>
<td align="left">B</td>
<td align="right">1</td>
<td align="right">53.53195</td>
<td align="right">67.7</td>
</tr>
<tr class="odd">
<td align="left">X-3</td>
<td align="left">X-3</td>
<td align="left">S3</td>
<td align="left">Female</td>
<td align="right">1</td>
<td align="left">A</td>
<td align="right">2</td>
<td align="right">47.61090</td>
<td align="right">78.9</td>
</tr>
<tr class="even">
<td align="left">X-4</td>
<td align="left">X-4</td>
<td align="left">S4</td>
<td align="left">Female</td>
<td align="right">1</td>
<td align="left">B</td>
<td align="right">2</td>
<td align="right">49.72870</td>
<td align="right">48.6</td>
</tr>
<tr class="odd">
<td align="left">X-5</td>
<td align="left">X-5</td>
<td align="left">S5</td>
<td align="left">Female</td>
<td align="right">1</td>
<td align="left">A</td>
<td align="right">3</td>
<td align="right">59.04509</td>
<td align="right">48.4</td>
</tr>
</tbody>
</table>
<p>You should note the following:</p>
<ul>
<li>The <code>counts</code> table is composed of raw microbial counts.
There is one row for each taxon, and one column for each sample.</li>
<li>The <code>tax</code> table is composed of taxonomy lineages. There
is one row for each taxon, and any number of columns each taxonomic
level (e.g., superkingdom, genus, species). The lowest level of taxonomy
serves as the rownames for the table, and is also stored in its own
column. Taxonomic levels increase in granularity from left to
right.</li>
<li>The <code>sample</code> table contains entries for each sample, with
unique sample IDs on the rows. The columns are metadata for the samples,
such as subjects or units on which repeated measures were taken,
groupings, pairings, and covariates.</li>
<li><code>rownames(counts) == rownames(tax)</code></li>
<li><code>colnames(counts) == colnames(sample)</code></li>
</ul>
</div>
<div class="section level3">
<h3 id="use-create_formatted_mae">Use <code>create_formatted_MAE()</code><a class="anchor" aria-label="anchor" href="#use-create_formatted_mae"></a>
</h3>
<p>So once your data are formatted correctly, you can pretty easily use
<code><a href="../reference/create_formatted_MAE.html">create_formatted_MAE()</a></code> like so:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">output</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_formatted_MAE.html">create_formatted_MAE</a></span><span class="op">(</span>counts_dat <span class="op">=</span> <span class="va">counts</span>,</span>
<span>                               tax_dat <span class="op">=</span> <span class="va">tax</span>,</span>
<span>                               metadata_dat <span class="op">=</span> <span class="va">sample</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">output</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "MultiAssayExperiment"</span></span>
<span><span class="co">## attr(,"package")</span></span>
<span><span class="co">## [1] "MultiAssayExperiment"</span></span></code></pre>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">MultiAssayExperiment</span><span class="fu">::</span><span class="fu">assays</span><span class="op">(</span><span class="va">output</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## List of length 1</span></span>
<span><span class="co">## names(1): MicrobeGenetics</span></span></code></pre>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">SummarizedExperiment</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">assays</a></span><span class="op">(</span><span class="va">output</span><span class="op">[[</span><span class="st">"MicrobeGenetics"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## List of length 1</span></span>
<span><span class="co">## names(1): MGX</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="adding-information-to-your-metadata-later-in-your-analysis">Adding information to your metadata later in your analysis<a class="anchor" aria-label="anchor" href="#adding-information-to-your-metadata-later-in-your-analysis"></a>
</h3>
<p>If information needs to be added to your data object at some point in
the analysis, it is easiest to manipulate the raw data objects
(potentially via <code><a href="../reference/parse_MAE_SE.html">parse_MAE_SE()</a></code>) and then recreate the
<code>MAE</code> object with <code><a href="../reference/create_formatted_MAE.html">create_formatted_MAE()</a></code>.</p>
</div>
</div>
<div class="section level2">
<h2 id="example-data">Example data<a class="anchor" aria-label="anchor" href="#example-data"></a>
</h2>
<p>To illustrate the capabilities of LegATo, we will turn to a published
dataset from the following paper:</p>
<p>Odom-Mabey AR, Gill CJ, Pieciak R et al. Characterization of
longitudinal nasopharyngeal microbiome patterns in maternally
HIV-exposed Zambian infants [version 1; peer review: 1 approved with
reservations]. Gates Open Res 2022, 6:143 (<a href="https://doi.org/10.12688/gatesopenres.14041.1" class="external-link uri">https://doi.org/10.12688/gatesopenres.14041.1</a>)</p>
<p>The raw dataset is archived in Zenodo:</p>
<p>Zenodo: Underlying data for ‘Characterization of longitudinal
nasopharyngeal microbiome patterns in maternally HIV-exposed Zambian
infants’. <a href="https://doi.org/10.5281/zenodo.725531324" class="external-link uri">https://doi.org/10.5281/zenodo.725531324</a></p>
<p>Further details on how the dataset was altered for inclusion in this
package are provided <a href="https://github.com/wejlab/LegATo/blob/main/inst/script/extdata_explanations.Rmd" class="external-link">here</a>.</p>
<div class="section level4">
<h4 id="example-data-context-and-structure">Example data context and structure<a class="anchor" aria-label="anchor" href="#example-data-context-and-structure"></a>
</h4>
<p>The example data consists of 167 NP swabs of healthy HIV-exposed,
uninfected (HEU; n=10) infants and their HIV(+) mothers and
HIV-unexposed, uninfected (HUU; n=10) infants and their HIV(-) mothers.
A total of 7 samples were collected per infant, with some missingness in
the data. These swabs were identified from a sample library collected in
Lusaka, Zambia between 2015 and 2016.</p>
<p>The analysis objective is to parse the association between the NP
resident bacteria and infant HIV exposure during the first 3.5 months
(14 weeks) of life, a critical time in microbiome maturation.</p>
<p>All data was processed with <code>PathoScope 2.0</code>, and the
sample outputs were aggregated with the <code>animalcules</code> R
package.</p>
<p>For this analysis, we will work with the infant data only and subset
the data accordingly.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"MAE.RDS"</span>, package <span class="op">=</span> <span class="st">"LegATo"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dat_subsetted</span> <span class="op">&lt;-</span> <span class="fu">MultiAssayExperiment</span><span class="fu">::</span><span class="fu"><a href="http://waldronlab.io/MultiAssayExperiment/reference/subsetBy.html" class="external-link">subsetByColData</a></span><span class="op">(</span><span class="va">dat</span>,</span>
<span>                                                       <span class="va">dat</span><span class="op">$</span><span class="va">MothChild</span> <span class="op">==</span> <span class="st">"Infant"</span><span class="op">)</span></span></code></pre></div>
<p>This leaves us with 129 samples in our analysis.</p>
</div>
</div>
<div class="section level2">
<h2 id="initial-data-exploration">Initial data exploration<a class="anchor" aria-label="anchor" href="#initial-data-exploration"></a>
</h2>
<div class="section level3">
<h3 id="mae-manipulation">MAE manipulation<a class="anchor" aria-label="anchor" href="#mae-manipulation"></a>
</h3>
<p><code>LegATo</code> has several functions for manipulating
<code>MAE</code> objects, delineated below:</p>
<div class="section level4">
<h4 id="clean-up-animalcules-formatted-maes">Clean up animalcules-formatted MAEs<a class="anchor" aria-label="anchor" href="#clean-up-animalcules-formatted-maes"></a>
</h4>
<p>If your data were aggregated via the <code>animalcules</code>
package, as was done for the example data, the samples were aggregated
at the strain taxonomic level and have residual taxonomy IDs present.
The <code><a href="../reference/clean_animalcules_MAE.html">clean_animalcules_MAE()</a></code> function cleans up data
suffering from these issues.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dat_cleaned</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/clean_animalcules_MAE.html">clean_animalcules_MAE</a></span><span class="op">(</span><span class="va">dat_subsetted</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Registered S3 method overwritten by 'httr':</span></span>
<span><span class="co">##   method         from  </span></span>
<span><span class="co">##   print.response rmutil</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="filter-mae">Filter MAE<a class="anchor" aria-label="anchor" href="#filter-mae"></a>
</h4>
<p>Many metagenomic pipelines identify taxon abundances at extremely
small levels, which can be noisy to deal with in an analysis. The
<code>filter_animalcules_MAE</code> function smoothly transforms reads
belonging to taxa with an overall genera threshold under the
<code>filter_prop</code> (filter proportion) argument, which we will set
as 0.005.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dat_filt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/filter_animalcules_MAE.html">filter_animalcules_MAE</a></span><span class="op">(</span><span class="va">dat_cleaned</span>, <span class="fl">0.05</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="parse-mae-to-extract-data">Parse MAE to extract data<a class="anchor" aria-label="anchor" href="#parse-mae-to-extract-data"></a>
</h4>
<p>If you want to take a closer look at your data, you can easily
extract it into the counts, taxonomy, and sample metadata tables using
the <code><a href="../reference/parse_MAE_SE.html">parse_MAE_SE()</a></code> function.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">parsed</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/parse_MAE_SE.html">parse_MAE_SE</a></span><span class="op">(</span><span class="va">dat_filt</span>, which_assay <span class="op">=</span> <span class="st">"MicrobeGenetics"</span>, type <span class="op">=</span> <span class="st">"MAE"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">parsed</span><span class="op">$</span><span class="va">counts</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span><span class="op">]</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span>caption <span class="op">=</span> <span class="st">"Counts Table"</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>Counts Table</caption>
<thead><tr class="header">
<th align="left"></th>
<th align="right">X1755</th>
<th align="right">X2216</th>
<th align="right">X2431</th>
<th align="right">X2561</th>
<th align="right">X2699</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Corynebacterium accolens</td>
<td align="right">0</td>
<td align="right">9643</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">43435</td>
</tr>
<tr class="even">
<td align="left">Corynebacterium ammoniagenes</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">Corynebacterium appendicis</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">Corynebacterium argentoratense</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">4</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">Corynebacterium aurimucosum</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">58</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">parsed</span><span class="op">$</span><span class="va">sam</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span>, <span class="op">]</span>  <span class="op">|&gt;</span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span>caption <span class="op">=</span> <span class="st">"Sample Metadata"</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>Sample Metadata</caption>
<thead><tr class="header">
<th align="left"></th>
<th align="left">Sample</th>
<th align="left">Subject</th>
<th align="left">HIVStatus</th>
<th align="left">MothChild</th>
<th align="right">timepoint</th>
<th align="right">Age</th>
<th align="right">pairing</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">X1755</td>
<td align="left">X1755</td>
<td align="left">0469-1</td>
<td align="left">Control</td>
<td align="left">Infant</td>
<td align="right">0</td>
<td align="right">7</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">X2216</td>
<td align="left">X2216</td>
<td align="left">0507-1</td>
<td align="left">Control</td>
<td align="left">Infant</td>
<td align="right">0</td>
<td align="right">6</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="left">X2431</td>
<td align="left">X2431</td>
<td align="left">0539-1</td>
<td align="left">Control</td>
<td align="left">Infant</td>
<td align="right">0</td>
<td align="right">9</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">X2561</td>
<td align="left">X2561</td>
<td align="left">0554-1</td>
<td align="left">HIV</td>
<td align="left">Infant</td>
<td align="right">0</td>
<td align="right">6</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">X2699</td>
<td align="left">X2699</td>
<td align="left">0620-1</td>
<td align="left">HIV</td>
<td align="left">Infant</td>
<td align="right">0</td>
<td align="right">4</td>
<td align="right">2</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">parsed</span><span class="op">$</span><span class="va">tax</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span>, <span class="op">]</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span>caption <span class="op">=</span> <span class="st">"Taxonomy Table"</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>Taxonomy Table</caption>
<colgroup>
<col width="19%">
<col width="8%">
<col width="9%">
<col width="8%">
<col width="11%">
<col width="12%">
<col width="10%">
<col width="19%">
</colgroup>
<thead><tr class="header">
<th align="left"></th>
<th align="left">superkingdom</th>
<th align="left">phylum</th>
<th align="left">class</th>
<th align="left">order</th>
<th align="left">family</th>
<th align="left">genus</th>
<th align="left">species</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Corynebacterium accolens</td>
<td align="left">Bacteria</td>
<td align="left">Actinobacteria</td>
<td align="left">Actinomycetia</td>
<td align="left">Corynebacteriales</td>
<td align="left">Corynebacteriaceae</td>
<td align="left">Corynebacterium</td>
<td align="left">Corynebacterium accolens</td>
</tr>
<tr class="even">
<td align="left">Corynebacterium ammoniagenes</td>
<td align="left">Bacteria</td>
<td align="left">Actinobacteria</td>
<td align="left">Actinomycetia</td>
<td align="left">Corynebacteriales</td>
<td align="left">Corynebacteriaceae</td>
<td align="left">Corynebacterium</td>
<td align="left">Corynebacterium ammoniagenes</td>
</tr>
<tr class="odd">
<td align="left">Corynebacterium appendicis</td>
<td align="left">Bacteria</td>
<td align="left">Actinobacteria</td>
<td align="left">Actinomycetia</td>
<td align="left">Corynebacteriales</td>
<td align="left">Corynebacteriaceae</td>
<td align="left">Corynebacterium</td>
<td align="left">Corynebacterium appendicis</td>
</tr>
<tr class="even">
<td align="left">Corynebacterium argentoratense</td>
<td align="left">Bacteria</td>
<td align="left">Actinobacteria</td>
<td align="left">Actinomycetia</td>
<td align="left">Corynebacteriales</td>
<td align="left">Corynebacteriaceae</td>
<td align="left">Corynebacterium</td>
<td align="left">Corynebacterium argentoratense</td>
</tr>
<tr class="odd">
<td align="left">Corynebacterium aurimucosum</td>
<td align="left">Bacteria</td>
<td align="left">Actinobacteria</td>
<td align="left">Actinomycetia</td>
<td align="left">Corynebacteriales</td>
<td align="left">Corynebacteriaceae</td>
<td align="left">Corynebacterium</td>
<td align="left">Corynebacterium aurimucosum</td>
</tr>
</tbody>
</table>
</div>
<div class="section level4">
<h4 id="summarizing-microbial-counts-data">Summarizing microbial counts data<a class="anchor" aria-label="anchor" href="#summarizing-microbial-counts-data"></a>
</h4>
<p>It is fairly convenient to summarize the average number of reads for
a report with <code><a href="../reference/get_summary_table.html">get_summary_table()</a></code>. The table groups by
user-provided discrete covariates.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">group_vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"HIVStatus"</span>, <span class="st">"MothChild"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/get_summary_table.html">get_summary_table</a></span><span class="op">(</span><span class="va">dat_filt</span>, <span class="va">group_vars</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span>caption <span class="op">=</span> <span class="st">"Summary Table"</span>, label <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>Summary Table</caption>
<colgroup>
<col width="14%">
<col width="14%">
<col width="15%">
<col width="14%">
<col width="14%">
<col width="14%">
<col width="14%">
</colgroup>
<thead><tr class="header">
<th align="left">HIVStatus</th>
<th align="left">MothChild</th>
<th align="right">mean_reads</th>
<th align="right">sd_reads</th>
<th align="right">min_reads</th>
<th align="right">max_reads</th>
<th align="right">num_total</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Control</td>
<td align="left">Infant</td>
<td align="right">156209.2</td>
<td align="right">408000.52</td>
<td align="right">24176</td>
<td align="right">3016276</td>
<td align="right">68</td>
</tr>
<tr class="even">
<td align="left">HIV</td>
<td align="left">Infant</td>
<td align="right">90008.2</td>
<td align="right">51395.08</td>
<td align="right">13218</td>
<td align="right">202079</td>
<td align="right">61</td>
</tr>
</tbody>
</table>
<p>The <code>get_top_taxa</code> function outputs a
<code>data.frame</code> that lists taxa in order of relative
abundance.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">best_genus</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_top_taxa.html">get_top_taxa</a></span><span class="op">(</span><span class="va">dat_filt</span>, <span class="st">"genus"</span><span class="op">)</span></span>
<span><span class="va">best_genus</span> <span class="op">|&gt;</span> <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span>caption <span class="op">=</span> <span class="st">"Table of genera, ranked by abundance"</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>Table of genera, ranked by abundance</caption>
<thead><tr class="header">
<th align="left">taxon</th>
<th align="right">allmeans</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Dolosigranulum</td>
<td align="right">0.1892754</td>
</tr>
<tr class="even">
<td align="left">Streptococcus</td>
<td align="right">0.1730879</td>
</tr>
<tr class="odd">
<td align="left">Moraxella</td>
<td align="right">0.1713469</td>
</tr>
<tr class="even">
<td align="left">Staphylococcus</td>
<td align="right">0.1554891</td>
</tr>
<tr class="odd">
<td align="left">Corynebacterium</td>
<td align="right">0.1290279</td>
</tr>
<tr class="even">
<td align="left">Other</td>
<td align="right">0.0979779</td>
</tr>
<tr class="odd">
<td align="left">Haemophilus</td>
<td align="right">0.0837949</td>
</tr>
</tbody>
</table>
</div>
<div class="section level4">
<h4 id="other-data-manipulation-functions">Other data manipulation functions<a class="anchor" aria-label="anchor" href="#other-data-manipulation-functions"></a>
</h4>
<p>If you want to conduct your own analyses, the
<code><a href="../reference/get_long_data.html">get_long_data()</a></code> function will prove convenient. The
<code><a href="../reference/get_stacked_data.html">get_stacked_data()</a></code> function can be used for certain
visualizations that utilize a relative abundance aggregation
approach.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">longdat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_long_data.html">get_long_data</a></span><span class="op">(</span><span class="va">dat_filt</span>, <span class="st">"genus"</span>, log <span class="op">=</span> <span class="cn">TRUE</span>, counts_to_CPM <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">stackeddat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_stacked_data.html">get_stacked_data</a></span><span class="op">(</span><span class="va">dat_filt</span>, <span class="st">"genus"</span>, covariate_1 <span class="op">=</span> <span class="st">"HIVStatus"</span>,</span>
<span>                               covariate_time <span class="op">=</span> <span class="st">"timepoint"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="visualizing-data">Visualizing Data<a class="anchor" aria-label="anchor" href="#visualizing-data"></a>
</h3>
<p>There are several plots by which we can visualize changes in relative
abundance over time, accounting for a given covariate. In this case, we
are interested in HIV exposure.</p>
<p>We’ll select a palette using <code>paletteer</code>.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">this_palette</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#FED439"</span>, <span class="st">"#709AE1"</span>, <span class="st">"#8A9197"</span>, <span class="st">"#D2AF81"</span>, <span class="st">"#FD7446"</span>, <span class="st">"#D5E4A2"</span>, <span class="st">"#197EC0"</span>, <span class="st">"#F05C3B"</span>, <span class="st">"#46732E"</span>,</span>
<span>                  <span class="st">"#71D0F5"</span>, <span class="st">"#370335"</span>, <span class="st">"#075149"</span>, <span class="st">"#C80813"</span>, <span class="st">"#91331F"</span>, <span class="st">"#1A9993"</span>, <span class="st">"#FD8CC1"</span><span class="op">)</span><span class="op">|&gt;</span></span>
<span>  <span class="fu">magrittr</span><span class="fu">::</span><span class="fu"><a href="https://magrittr.tidyverse.org/reference/aliases.html" class="external-link">extract</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">best_genus</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="section level4">
<h4 id="alluvial-plot">Alluvial plot<a class="anchor" aria-label="anchor" href="#alluvial-plot"></a>
</h4>
<p>Alluvial diagrams illustrate individual taxa as stream fields that
change position at different time points. The height of a stream field
represents the relative abundance of that taxon. At a given time point,
stream fields are ranked from the highest to lowest abundance (top to
bottom). These can be constructed with <code><a href="../reference/plot_alluvial.html">plot_alluvial()</a></code>.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_alluvial.html">plot_alluvial</a></span><span class="op">(</span>dat <span class="op">=</span> <span class="va">dat_filt</span>, </span>
<span>              taxon_level <span class="op">=</span> <span class="st">"genus"</span>, </span>
<span>              covariate_1 <span class="op">=</span> <span class="st">"HIVStatus"</span>,</span>
<span>              covariate_time <span class="op">=</span> <span class="st">"timepoint"</span>,</span>
<span>              palette_input <span class="op">=</span> <span class="va">this_palette</span>,</span>
<span>              subtitle <span class="op">=</span> <span class="st">"Alluvial plot"</span><span class="op">)</span></span></code></pre></div>
<p><img src="LegATo_vignette_files/figure-html/unnamed-chunk-13-1.png" width="700"></p>
</div>
<div class="section level4">
<h4 id="spaghetti-plot">Spaghetti plot<a class="anchor" aria-label="anchor" href="#spaghetti-plot"></a>
</h4>
<p>We can create spaghetti or volatility plots to elucidate changes over
time on a sample level for a given taxon. This is advantageous as other
visualization methods are often aggregates of multiple samples and lack
granularity. These plots can be created with
<code><a href="../reference/plot_spaghetti.html">plot_spaghetti()</a></code>.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_spaghetti.html">plot_spaghetti</a></span><span class="op">(</span>dat <span class="op">=</span> <span class="va">dat_filt</span>,</span>
<span>               covariate_time <span class="op">=</span> <span class="st">"timepoint"</span>,</span>
<span>               covariate_1 <span class="op">=</span> <span class="st">"HIVStatus"</span>,</span>
<span>               unit_var <span class="op">=</span> <span class="st">"Subject"</span>,</span>
<span>               taxon_level <span class="op">=</span> <span class="st">"genus"</span>,</span>
<span>               which_taxon <span class="op">=</span> <span class="st">"Staphylococcus"</span>,</span>
<span>               palette_input<span class="op">=</span> <span class="va">this_palette</span>,</span>
<span>               title <span class="op">=</span> <span class="st">"Spaghetti Plot"</span>,</span>
<span>               subtitle <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Infant Age (Days)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Relative Abundance (log CPM)"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="stacked-bar-plot">Stacked bar plot<a class="anchor" aria-label="anchor" href="#stacked-bar-plot"></a>
</h4>
<p>Stacked bar plots are used here to visualize the relative abundance
of microbes at a given taxonomic level in each sample, represented as a
single bar, labeled by time point, and plotted within each HIV exposure
status group for separate mothers and infant comparisons. Use
<code>plot_stacked_bar</code>.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_stacked_bar.html">plot_stacked_bar</a></span><span class="op">(</span><span class="va">dat_filt</span>, <span class="st">"genus"</span>, </span>
<span>             <span class="st">"HIVStatus"</span>,</span>
<span>             <span class="st">"timepoint"</span>,</span>
<span>             palette_input <span class="op">=</span> <span class="va">this_palette</span><span class="op">)</span></span></code></pre></div>
<p><img src="LegATo_vignette_files/figure-html/unnamed-chunk-15-1.png" width="700"></p>
</div>
<div class="section level4">
<h4 id="stacked-area-chart">Stacked area chart<a class="anchor" aria-label="anchor" href="#stacked-area-chart"></a>
</h4>
<p>Stacked area charts are similar to stacked bar plots, but provide for
continuity between time points. These are created with
<code><a href="../reference/plot_stacked_area.html">plot_stacked_area()</a></code>.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_stacked_area.html">plot_stacked_area</a></span><span class="op">(</span><span class="va">dat_filt</span>, <span class="st">"genus"</span>, </span>
<span>                  <span class="st">"HIVStatus"</span>,</span>
<span>                  <span class="st">"timepoint"</span>,</span>
<span>                  palette_input <span class="op">=</span> <span class="va">this_palette</span><span class="op">)</span></span></code></pre></div>
<p><img src="LegATo_vignette_files/figure-html/unnamed-chunk-16-1.png" width="700"></p>
</div>
<div class="section level4">
<h4 id="heatmap">Heatmap<a class="anchor" aria-label="anchor" href="#heatmap"></a>
</h4>
<p>With <code>plot_heatmap</code>, you can plot a heatmap of a specific
microbe to determine changes along one or more covariates.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">this_taxon</span> <span class="op">&lt;-</span> <span class="va">parsed</span><span class="op">$</span><span class="va">counts</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">animalcules</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/animalcules/man/upsample_counts.html" class="external-link">upsample_counts</a></span><span class="op">(</span><span class="va">parsed</span><span class="op">$</span><span class="va">tax</span>, <span class="st">"genus"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">animalcules</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/animalcules/man/counts_to_logcpm.html" class="external-link">counts_to_logcpm</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_heatmap.html">plot_heatmap</a></span><span class="op">(</span>inputData <span class="op">=</span> <span class="va">this_taxon</span>,</span>
<span>                  annotationData <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">parsed</span><span class="op">$</span><span class="va">sam</span>, <span class="st">"timepoint"</span>, <span class="st">"HIVStatus"</span>, <span class="st">"pairing"</span><span class="op">)</span>,</span>
<span>                  name <span class="op">=</span> <span class="st">"Data"</span>,</span>
<span>                  plot_title <span class="op">=</span> <span class="st">"Example"</span>,</span>
<span>                  plottingColNames <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                  annotationColNames <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                  colList <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                  scale <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                  showColumnNames <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                  showRowNames <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                  colorSets <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Set1"</span>, <span class="st">"Set2"</span>, <span class="st">"Set3"</span>, <span class="st">"Pastel1"</span>, <span class="st">"Pastel2"</span>, <span class="st">"Accent"</span>, <span class="st">"Dark2"</span>,</span>
<span>                                <span class="st">"Paired"</span><span class="op">)</span>,</span>
<span>                  choose_color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"blue"</span>, <span class="st">"gray95"</span>, <span class="st">"red"</span><span class="op">)</span>,</span>
<span>                  split_heatmap <span class="op">=</span> <span class="st">"none"</span>,</span>
<span>                  column_order <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="LegATo_vignette_files/figure-html/unnamed-chunk-17-1.png" width="700"></p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="longitudinal-data-analysis">Longitudinal data analysis<a class="anchor" aria-label="anchor" href="#longitudinal-data-analysis"></a>
</h2>
<p>For a concrete analysis of longitudinal microbiome data,
<code>LegATo</code> provides NMIT, both a paired and unpaired
multivariate Hotelling’s T-squared test, generalized estimating
equations (GEEs) and linear mixed effects models (LMEMs/LMMs).</p>
<p><strong>Detailed explanations of each are available on the LegATo
website:</strong></p>
<ul>
<li><a href="https://wejlab.github.io/LegATo-docs/articles/NMIT.html" class="external-link">Nonparametric
microbial interdependence test (NMIT)</a></li>
<li><a href="https://wejlab.github.io/LegATo-docs/articles/Modeling.html" class="external-link">Modeling
with GEEs and LMMs</a></li>
<li><a href="https://wejlab.github.io/LegATo-docs/articles/NMIT.html" class="external-link">Hotelling’s
T-Squared test</a></li>
</ul>
<p>Otherwise a brief overview of each method is provided below.</p>
<div class="section level3">
<h3 id="nonparametric-microbial-interdependence-test-nmit">Nonparametric microbial interdependence test (NMIT)<a class="anchor" aria-label="anchor" href="#nonparametric-microbial-interdependence-test-nmit"></a>
</h3>
<p>NMIT is a multivariate distance-based test intended to evaluate the
association between key phenotypic variables and microbial
interdependence. The test determines longitudinal sample similarity as a
function of temporal microbial composition.</p>
<p>The authors thank Yilong Zhang for providing his code for adaptation
into LegATo.</p>
<p>Citations:</p>
<p>Yilong Zhang, Sung Won Han, Laura M Cox, and Huilin Li. A
multivariate distance-based analytic framework for microbial
interdependence association test in longitudinal study. Genetic
epidemiology, 41(8):769–778, 2017. <a href="doi:10.1002/gepi.22065" class="uri">doi:10.1002/gepi.22065</a>.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dat_0.1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/filter_animalcules_MAE.html">filter_animalcules_MAE</a></span><span class="op">(</span><span class="va">dat_cleaned</span>, <span class="fl">0.1</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/NMIT.html">NMIT</a></span><span class="op">(</span><span class="va">dat_0.1</span>, unit_var <span class="op">=</span> <span class="st">"Subject"</span>, fixed_cov <span class="op">=</span> <span class="st">"HIVStatus"</span>,</span>
<span>     covariate_time <span class="op">=</span> <span class="st">"timepoint"</span>,</span>
<span>     method <span class="op">=</span> <span class="st">"kendall"</span>, dist_type <span class="op">=</span> <span class="st">"F"</span>,</span>
<span>     heatmap <span class="op">=</span> <span class="cn">TRUE</span>, classify <span class="op">=</span> <span class="cn">FALSE</span>, fill_na <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></code></pre></div>
<p><img src="LegATo_vignette_files/figure-html/unnamed-chunk-18-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="hotellings-t2-test">Hotelling’s T^2 Test<a class="anchor" aria-label="anchor" href="#hotellings-t2-test"></a>
</h3>
<p>Hotelling’s T2 tests can be used to determine whether the microbiome
profiles exhibit notable differences or trends across time and groups.
We may then use t-tests to identify which genera contributed most to
these differences.</p>
<p>For this example, HEU and HUU infants are designated as the two
sampling units on which the relative abundances of the p most abundant
genera will be measured.</p>
<p>For paired tests, we chose p = 6 variables to ensure that n &lt; p so
that singularity could be avoided and T2 could be properly computed,
where n is the number of measurements in a sampling unit. Normality is
met by using microbe abundances in log CPM units, which is calculated
within the function.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/test_hotelling_t2.html">test_hotelling_t2</a></span><span class="op">(</span>dat <span class="op">=</span> <span class="va">dat_filt</span>,</span>
<span>                  test_index <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">dat_filt</span><span class="op">$</span><span class="va">MothChild</span> <span class="op">==</span> <span class="st">"Infant"</span> <span class="op">&amp;</span></span>
<span>                                       <span class="va">dat_filt</span><span class="op">$</span><span class="va">timepoint</span> <span class="op">==</span> <span class="fl">6</span><span class="op">)</span>,</span>
<span>                  taxon_level <span class="op">=</span> <span class="st">"genus"</span>,</span>
<span>                  <span class="co"># To avoid n &lt; p, use top 5-6 species</span></span>
<span>                  num_taxa <span class="op">=</span> <span class="fl">6</span>,</span>
<span>                  paired <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                  grouping_var <span class="op">=</span> <span class="st">"HIVStatus"</span>,</span>
<span>                  pairing_var <span class="op">=</span> <span class="st">"pairing"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $df1</span></span>
<span><span class="co">## [1] 6</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $df2</span></span>
<span><span class="co">## [1] 2</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $crit_F</span></span>
<span><span class="co">## [1] 19.32953</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $F_stat</span></span>
<span><span class="co">## [1] 2.690561</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $pvalue</span></span>
<span><span class="co">## [1] 0.2955849</span></span></code></pre>
<p>Group comparisons can also be tested on unpaired data:</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/test_hotelling_t2.html">test_hotelling_t2</a></span><span class="op">(</span>dat <span class="op">=</span> <span class="va">dat_filt</span>,</span>
<span>                  test_index <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">dat_filt</span><span class="op">$</span><span class="va">timepoint</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span>,</span>
<span>                  taxon_level <span class="op">=</span> <span class="st">"genus"</span>,</span>
<span>                  <span class="co"># To avoid n &lt; p, use top 5-6 species</span></span>
<span>                  num_taxa <span class="op">=</span> <span class="fl">6</span>,</span>
<span>                  grouping_var <span class="op">=</span> <span class="st">"HIVStatus"</span>,</span>
<span>                  unit_var <span class="op">=</span> <span class="st">"Subject"</span>,</span>
<span>                  paired <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $df1</span></span>
<span><span class="co">## [1] 6</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $df2</span></span>
<span><span class="co">## [1] 13</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $crit_F</span></span>
<span><span class="co">## [1] 2.915269</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $F_stat</span></span>
<span><span class="co">## [1] 0.8499803</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $pvalue</span></span>
<span><span class="co">## [1] 0.5545602</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="modeling">Modeling<a class="anchor" aria-label="anchor" href="#modeling"></a>
</h3>
<div class="section level4">
<h4 id="generalized-estimating-equations-gees">Generalized Estimating Equations (GEEs)<a class="anchor" aria-label="anchor" href="#generalized-estimating-equations-gees"></a>
</h4>
<p>Generalized estimating equations (GEEs) as described in Liang and
Zeger (1986) and extended by Agresti (2002) have been widely used for
modeling longitudinal data, and more recently for longitudinal
microbiome data.</p>
<p>For each genus present in the microbial aggregate of samples, we
model normalized log CPM relative taxon counts, estimating the effects
of time point and HIV exposure status and their interaction, while
accounting for the underlying structure of clusters formed by individual
subjects.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">output</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_gee_model.html">run_gee_model</a></span><span class="op">(</span><span class="va">dat_filt</span>, unit_var <span class="op">=</span> <span class="st">"Subject"</span>,</span>
<span>                        fixed_cov <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"HIVStatus"</span>, <span class="st">"timepoint"</span><span class="op">)</span>,</span>
<span>                        corstr <span class="op">=</span> <span class="st">"ar1"</span>,</span>
<span>                        plot_out <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                        plotsave_loc <span class="op">=</span> <span class="st">"."</span>,</span>
<span>                        plot_terms <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">output</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span>caption <span class="op">=</span> <span class="st">"GEE Outputs"</span><span class="op">)</span></span></code></pre></div>
<table style="width:100%;" class="table">
<caption>GEE Outputs</caption>
<colgroup>
<col width="9%">
<col width="16%">
<col width="11%">
<col width="7%">
<col width="11%">
<col width="10%">
<col width="10%">
<col width="12%">
<col width="9%">
</colgroup>
<thead><tr class="header">
<th align="left">Coefficient</th>
<th align="right">Coefficient Estimate</th>
<th align="right">Standard Error</th>
<th align="right">Statistic</th>
<th align="right">Unadj p-value</th>
<th align="right">Lower 95% CI</th>
<th align="right">Upper 95% CI</th>
<th align="left">Taxon</th>
<th align="right">Adj p-value</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">54987.561</td>
<td align="right">45931.419</td>
<td align="right">1.433208</td>
<td align="right">0.2312416</td>
<td align="right">-35036.366</td>
<td align="right">145011.49</td>
<td align="left">Dolosigranulum</td>
<td align="right">0.2697819</td>
</tr>
<tr class="even">
<td align="left">(Intercept)</td>
<td align="right">4623.167</td>
<td align="right">3270.381</td>
<td align="right">1.998401</td>
<td align="right">0.1574653</td>
<td align="right">-1786.661</td>
<td align="right">11033.00</td>
<td align="left">Streptococcus</td>
<td align="right">0.2204514</td>
</tr>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">10838.983</td>
<td align="right">4950.443</td>
<td align="right">4.793900</td>
<td align="right">0.0285607</td>
<td align="right">1136.293</td>
<td align="right">20541.67</td>
<td align="left">Moraxella</td>
<td align="right">0.0499812</td>
</tr>
<tr class="even">
<td align="left">(Intercept)</td>
<td align="right">59424.348</td>
<td align="right">26172.622</td>
<td align="right">5.155068</td>
<td align="right">0.0231786</td>
<td align="right">8126.953</td>
<td align="right">110721.74</td>
<td align="left">Staphylococcus</td>
<td align="right">0.0499812</td>
</tr>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">46510.999</td>
<td align="right">20784.082</td>
<td align="right">5.007831</td>
<td align="right">0.0252329</td>
<td align="right">5774.948</td>
<td align="right">87247.05</td>
<td align="left">Corynebacterium</td>
<td align="right">0.0499812</td>
</tr>
<tr class="even">
<td align="left">(Intercept)</td>
<td align="right">13394.894</td>
<td align="right">4693.161</td>
<td align="right">8.146062</td>
<td align="right">0.0043155</td>
<td align="right">4196.468</td>
<td align="right">22593.32</td>
<td align="left">Other</td>
<td align="right">0.0302084</td>
</tr>
</tbody>
</table>
<p>You can also create plots of the covariates, which will be saved to a
folder specified by the user:</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tempfolder</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="va">tempfolder</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Trying out plotting</span></span>
<span><span class="va">output</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_gee_model.html">run_gee_model</a></span><span class="op">(</span><span class="va">dat_filt</span>, unit_var <span class="op">=</span> <span class="st">"Subject"</span>,</span>
<span>              taxon_level <span class="op">=</span> <span class="st">"genus"</span>,</span>
<span>              fixed_cov <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"HIVStatus"</span>, <span class="st">"timepoint"</span><span class="op">)</span>,</span>
<span>              corstr <span class="op">=</span> <span class="st">"ar1"</span>,</span>
<span>              plot_out <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>              plotsave_loc <span class="op">=</span> <span class="va">tempfolder</span>,</span>
<span>              plot_terms <span class="op">=</span> <span class="st">"timepoint"</span>,</span>
<span>              width <span class="op">=</span> <span class="fl">6</span>, height <span class="op">=</span> <span class="fl">4</span>, units <span class="op">=</span> <span class="st">"in"</span>, scale <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/unlink.html" class="external-link">unlink</a></span><span class="op">(</span><span class="va">tempfolder</span>, recursive <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="Dolosigranulum_timepoint.png" width="50%" style="display: block; margin: auto;"><img src="Streptococcus_timepoint.png" width="50%" style="display: block; margin: auto;"></p>
</div>
<div class="section level4">
<h4 id="linear-mixed-models">Linear Mixed Models<a class="anchor" aria-label="anchor" href="#linear-mixed-models"></a>
</h4>
<p>Similarly, you can also run linear mixed-effects models:</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">output</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_lmm_model.html">run_lmm_model</a></span><span class="op">(</span><span class="va">dat_filt</span>, unit_var <span class="op">=</span> <span class="st">"Subject"</span>,</span>
<span>                        taxon_level <span class="op">=</span> <span class="st">"genus"</span>,</span>
<span>                        fixed_cov <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"timepoint"</span>, <span class="st">"HIVStatus"</span><span class="op">)</span>,</span>
<span>                        plot_out <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                        plotsave_loc <span class="op">=</span> <span class="st">"."</span>,</span>
<span>                        plot_terms <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "Dolosigranulum"</span></span>
<span><span class="co">## [1] "Streptococcus"</span></span>
<span><span class="co">## [1] "Moraxella"</span></span>
<span><span class="co">## [1] "Staphylococcus"</span></span>
<span><span class="co">## [1] "Corynebacterium"</span></span>
<span><span class="co">## [1] "Other"</span></span>
<span><span class="co">## [1] "Haemophilus"</span></span></code></pre>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">output</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span>caption <span class="op">=</span> <span class="st">"LMM Outputs"</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>LMM Outputs</caption>
<colgroup>
<col width="6%">
<col width="10%">
<col width="18%">
<col width="12%">
<col width="8%">
<col width="7%">
<col width="12%">
<col width="13%">
<col width="10%">
</colgroup>
<thead><tr class="header">
<th align="left">effect</th>
<th align="left">Coefficient</th>
<th align="right">Coefficient Estimate</th>
<th align="right">Standard Error</th>
<th align="right">Statistic</th>
<th align="right">df</th>
<th align="right">Unadj p-value</th>
<th align="left">Taxon</th>
<th align="right">Adj p-value</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">fixed</td>
<td align="left">(Intercept)</td>
<td align="right">54874.112</td>
<td align="right">36388.018</td>
<td align="right">1.508027</td>
<td align="right">60.58909</td>
<td align="right">0.1367446</td>
<td align="left">Dolosigranulum</td>
<td align="right">0.1914424</td>
</tr>
<tr class="even">
<td align="left">fixed</td>
<td align="left">(Intercept)</td>
<td align="right">5145.285</td>
<td align="right">4970.582</td>
<td align="right">1.035147</td>
<td align="right">38.91848</td>
<td align="right">0.3069896</td>
<td align="left">Streptococcus</td>
<td align="right">0.3581545</td>
</tr>
<tr class="odd">
<td align="left">fixed</td>
<td align="left">(Intercept)</td>
<td align="right">10840.225</td>
<td align="right">5796.478</td>
<td align="right">1.870140</td>
<td align="right">25.84537</td>
<td align="right">0.0728319</td>
<td align="left">Moraxella</td>
<td align="right">0.1274558</td>
</tr>
<tr class="even">
<td align="left">fixed</td>
<td align="left">(Intercept)</td>
<td align="right">60627.051</td>
<td align="right">16682.279</td>
<td align="right">3.634219</td>
<td align="right">44.96890</td>
<td align="right">0.0007132</td>
<td align="left">Staphylococcus</td>
<td align="right">0.0049921</td>
</tr>
<tr class="odd">
<td align="left">fixed</td>
<td align="left">(Intercept)</td>
<td align="right">45500.592</td>
<td align="right">14615.001</td>
<td align="right">3.113280</td>
<td align="right">62.16246</td>
<td align="right">0.0027961</td>
<td align="left">Corynebacterium</td>
<td align="right">0.0097863</td>
</tr>
<tr class="even">
<td align="left">fixed</td>
<td align="left">(Intercept)</td>
<td align="right">12702.733</td>
<td align="right">5455.653</td>
<td align="right">2.328362</td>
<td align="right">23.11382</td>
<td align="right">0.0289964</td>
<td align="left">Other</td>
<td align="right">0.0676583</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="section level2">
<h2 id="session-info">Session Info<a class="anchor" aria-label="anchor" href="#session-info"></a>
</h2>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## R version 4.3.1 (2023-06-16)</span></span>
<span><span class="co">## Platform: x86_64-pc-linux-gnu (64-bit)</span></span>
<span><span class="co">## Running under: AlmaLinux 8.9 (Midnight Oncilla)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Matrix products: default</span></span>
<span><span class="co">## BLAS:   /share/pkg.8/r/4.3.1/install/lib64/R/lib/libRblas.so </span></span>
<span><span class="co">## LAPACK: /share/pkg.8/r/4.3.1/install/lib64/R/lib/libRlapack.so;  LAPACK version 3.11.0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## locale:</span></span>
<span><span class="co">##  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C              </span></span>
<span><span class="co">##  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8    </span></span>
<span><span class="co">##  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8   </span></span>
<span><span class="co">##  [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                 </span></span>
<span><span class="co">##  [9] LC_ADDRESS=C               LC_TELEPHONE=C            </span></span>
<span><span class="co">## [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## time zone: America/New_York</span></span>
<span><span class="co">## tzcode source: system (glibc)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## attached base packages:</span></span>
<span><span class="co">## [1] stats     graphics  grDevices utils     datasets  methods   base     </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## other attached packages:</span></span>
<span><span class="co">## [1] LegATo_0.99.0    BiocStyle_2.28.0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## loaded via a namespace (and not attached):</span></span>
<span><span class="co">##   [1] splines_4.3.1               bitops_1.0-7               </span></span>
<span><span class="co">##   [3] tibble_3.2.1                XML_3.99-0.16.1            </span></span>
<span><span class="co">##   [5] rpart_4.1.19                rex_1.2.1                  </span></span>
<span><span class="co">##   [7] lifecycle_1.0.4             edgeR_3.42.4               </span></span>
<span><span class="co">##   [9] doParallel_1.0.17           globals_0.16.2             </span></span>
<span><span class="co">##  [11] lattice_0.21-8              MASS_7.3-60                </span></span>
<span><span class="co">##  [13] insight_0.19.7              MultiAssayExperiment_1.28.0</span></span>
<span><span class="co">##  [15] backports_1.4.1             magrittr_2.0.3             </span></span>
<span><span class="co">##  [17] limma_3.56.2                plotly_4.10.2              </span></span>
<span><span class="co">##  [19] sass_0.4.8                  rmarkdown_2.25             </span></span>
<span><span class="co">##  [21] jquerylib_0.1.4             yaml_2.3.8                 </span></span>
<span><span class="co">##  [23] askpass_1.2.0               reticulate_1.30            </span></span>
<span><span class="co">##  [25] minqa_1.2.6                 RColorBrewer_1.1-3         </span></span>
<span><span class="co">##  [27] multcomp_1.4-25             abind_1.4-5                </span></span>
<span><span class="co">##  [29] zlibbioc_1.48.0             GenomicRanges_1.54.1       </span></span>
<span><span class="co">##  [31] purrr_1.0.2                 BiocGenerics_0.48.1        </span></span>
<span><span class="co">##  [33] RCurl_1.98-1.14             TH.data_1.1-2              </span></span>
<span><span class="co">##  [35] sandwich_3.1-0              circlize_0.4.15            </span></span>
<span><span class="co">##  [37] GenomeInfoDbData_1.2.11     IRanges_2.36.0             </span></span>
<span><span class="co">##  [39] S4Vectors_0.40.2            ggrepel_0.9.3              </span></span>
<span><span class="co">##  [41] rmutil_1.1.10               inline_0.3.19              </span></span>
<span><span class="co">##  [43] listenv_0.9.0               rentrez_1.2.3              </span></span>
<span><span class="co">##  [45] vegan_2.6-4                 umap_0.2.10.0              </span></span>
<span><span class="co">##  [47] RSpectra_0.16-1             spatial_7.3-16             </span></span>
<span><span class="co">##  [49] parallelly_1.36.0           pkgdown_2.0.7              </span></span>
<span><span class="co">##  [51] permute_0.9-7               codetools_0.2-19           </span></span>
<span><span class="co">##  [53] DelayedArray_0.28.0         DT_0.28                    </span></span>
<span><span class="co">##  [55] tidyselect_1.2.0            shape_1.4.6                </span></span>
<span><span class="co">##  [57] ggeffects_1.3.4             farver_2.1.1               </span></span>
<span><span class="co">##  [59] broom.mixed_0.2.9.4         lme4_1.1-35.1              </span></span>
<span><span class="co">##  [61] stable_1.1.6                matrixStats_1.2.0          </span></span>
<span><span class="co">##  [63] stats4_4.3.1                jsonlite_1.8.8             </span></span>
<span><span class="co">##  [65] GetoptLong_1.0.5            ellipsis_0.3.2             </span></span>
<span><span class="co">##  [67] survival_3.5-5              ggalluvial_0.12.5          </span></span>
<span><span class="co">##  [69] iterators_1.0.14            emmeans_1.9.0              </span></span>
<span><span class="co">##  [71] systemfonts_1.0.4           foreach_1.5.2              </span></span>
<span><span class="co">##  [73] tools_4.3.1                 ragg_1.2.5                 </span></span>
<span><span class="co">##  [75] Rcpp_1.0.12                 glue_1.7.0                 </span></span>
<span><span class="co">##  [77] SparseArray_1.2.3           BiocBaseUtils_1.4.0        </span></span>
<span><span class="co">##  [79] xfun_0.41                   mgcv_1.8-42                </span></span>
<span><span class="co">##  [81] DESeq2_1.40.1               MatrixGenerics_1.14.0      </span></span>
<span><span class="co">##  [83] GenomeInfoDb_1.38.5         dplyr_1.1.4                </span></span>
<span><span class="co">##  [85] numDeriv_2016.8-1.1         withr_3.0.0                </span></span>
<span><span class="co">##  [87] BiocManager_1.30.22         timeSeries_4030.106.9000   </span></span>
<span><span class="co">##  [89] fastmap_1.1.1               boot_1.3-28.1              </span></span>
<span><span class="co">##  [91] fansi_1.0.6                 shinyjs_2.1.0              </span></span>
<span><span class="co">##  [93] openssl_2.1.1               animalcules_1.18.2         </span></span>
<span><span class="co">##  [95] digest_0.6.34               R6_2.5.1                   </span></span>
<span><span class="co">##  [97] estimability_1.4.1          textshaping_0.3.6          </span></span>
<span><span class="co">##  [99] colorspace_2.1-0            Cairo_1.6-2                </span></span>
<span><span class="co">## [101] modeest_2.4.0               utf8_1.2.4                 </span></span>
<span><span class="co">## [103] tidyr_1.3.1                 generics_0.1.3             </span></span>
<span><span class="co">## [105] data.table_1.14.10          httr_1.4.7                 </span></span>
<span><span class="co">## [107] htmlwidgets_1.6.4           S4Arrays_1.2.0             </span></span>
<span><span class="co">## [109] pkgconfig_2.0.3             gtable_0.3.4               </span></span>
<span><span class="co">## [111] tsne_0.1-3.1                timeDate_4032.109          </span></span>
<span><span class="co">## [113] ComplexHeatmap_2.16.0       covr_3.6.2                 </span></span>
<span><span class="co">## [115] XVector_0.42.0              furrr_0.3.1                </span></span>
<span><span class="co">## [117] htmltools_0.5.7             bookdown_0.34              </span></span>
<span><span class="co">## [119] clue_0.3-65                 scales_1.3.0               </span></span>
<span><span class="co">## [121] Biobase_2.62.0              png_0.1-8                  </span></span>
<span><span class="co">## [123] knitr_1.45                  rstudioapi_0.15.0          </span></span>
<span><span class="co">## [125] reshape2_1.4.4              rjson_0.2.21               </span></span>
<span><span class="co">## [127] nloptr_2.0.3                statip_0.2.3               </span></span>
<span><span class="co">## [129] coda_0.19-4                 nlme_3.1-162               </span></span>
<span><span class="co">## [131] zoo_1.8-12                  cachem_1.0.8               </span></span>
<span><span class="co">## [133] GlobalOptions_0.1.2         stringr_1.5.1              </span></span>
<span><span class="co">## [135] parallel_4.3.1              fBasics_4022.94.9000       </span></span>
<span><span class="co">## [137] desc_1.4.3                  pillar_1.9.0               </span></span>
<span><span class="co">## [139] grid_4.3.1                  vctrs_0.6.5                </span></span>
<span><span class="co">## [141] xtable_1.8-4                cluster_2.1.4              </span></span>
<span><span class="co">## [143] evaluate_0.23               magick_2.7.4               </span></span>
<span><span class="co">## [145] mvtnorm_1.2-4               cli_3.6.2                  </span></span>
<span><span class="co">## [147] locfit_1.5-9.8              compiler_4.3.1             </span></span>
<span><span class="co">## [149] rlang_1.1.3                 crayon_1.5.2               </span></span>
<span><span class="co">## [151] labeling_0.4.3              forcats_1.0.0              </span></span>
<span><span class="co">## [153] plyr_1.8.9                  fs_1.6.3                   </span></span>
<span><span class="co">## [155] stringi_1.8.3               viridisLite_0.4.2          </span></span>
<span><span class="co">## [157] BiocParallel_1.36.0         TBSignatureProfiler_1.15.0 </span></span>
<span><span class="co">## [159] assertthat_0.2.1            lmerTest_3.1-3             </span></span>
<span><span class="co">## [161] munsell_0.5.0               lazyeval_0.2.2             </span></span>
<span><span class="co">## [163] geepack_1.3.9               Matrix_1.6-5               </span></span>
<span><span class="co">## [165] hms_1.1.3                   stabledist_0.7-1           </span></span>
<span><span class="co">## [167] future_1.32.0               ggplot2_3.4.4              </span></span>
<span><span class="co">## [169] statmod_1.5.0               haven_2.5.4                </span></span>
<span><span class="co">## [171] SummarizedExperiment_1.32.0 highr_0.10                 </span></span>
<span><span class="co">## [173] GUniFrac_1.8                broom_1.0.5                </span></span>
<span><span class="co">## [175] memoise_2.0.1               bslib_0.6.1                </span></span>
<span><span class="co">## [177] ape_5.7-1</span></span></code></pre>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Site created by Aubrey Odom.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
